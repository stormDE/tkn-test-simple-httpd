apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: recreate-homepage
spec:
  params:
  - name: appendix
    type: string
  steps:
    - name: recreate-configmap
      image: registry.redhat.io/openshift4/ose-cli
      script: |
        #!/bin/bash

        oc delete configmap homepage
        cat <<EOF | oc create -f -
        apiVersion: v1
        kind: ConfigMap
        metadata:
          name: homepage
          labels:
            app.kubernetes.io/generated-by: tkn
            {{- include "tekton-test.labels" . | nindent 12 }}
        data:
          index.html: <p>Hello World and $(params.appendix)! This is generated by a Tekton Pipeline!</p>
        EOF
        oc rollout restart deployment/{{ include "tekton-test.fullname" . }}